import { Meta, Story, Canvas, Controls, ArgTypes } from '@storybook/addon-docs/blocks'
import * as NetworkButtonStories from './NetworkButton.stories'

<Meta of={NetworkButtonStories} />

# NetworkButton

A network-aware button component that automatically displays different states based on API call status. Built on PrimeVue Button component with automatic state management for loading, success, error, and default states.

## Overview

The NetworkButton component is designed to provide a seamless user experience when dealing with network requests. It automatically manages its visual state based on the API call lifecycle, showing appropriate feedback to users without requiring manual state management.

### Key Features

- **Automatic State Management**: Automatically switches between default, loading, success, and error states
- **PrimeVue Integration**: Built on PrimeVue Button with full styling support
- **Relaunchable Actions**: Configurable retry functionality for both success and error states
- **Customizable Appearance**: Full control over text, icons, and styling for each state
- **TypeScript Support**: Comprehensive type definitions for all props and states
- **Accessibility**: Inherits PrimeVue Button's accessibility features

## Basic Usage

<Canvas of={NetworkButtonStories.Default} />

The most basic usage requires only a `query` prop that implements the `ApiInterface`:

```vue
<template>
  <NetworkButton :query="myApiQuery" />
</template>

<script setup>
import { NetworkButton } from '@nside/wefa'
import { useApiClient } from '@/composables/api'

const apiClient = useApiClient()
const myApiQuery = apiClient.post('/api/submit', { data: 'example' })
</script>
```

## State Management

The NetworkButton automatically manages four distinct states:

### 1. Default State

- Shown when the API call hasn't been made yet
- Button is enabled and ready for user interaction
- Default text: "Submit"

### 2. Loading State

- Shown while the API call is in progress
- Button is disabled to prevent multiple submissions
- Shows loading spinner
- Default text: "Loading..."

### 3. Success State

- Shown when the API call completes successfully
- Button is disabled by default (can be made relaunchable)
- Default text: "Success"

### 4. Error State

- Shown when the API call fails
- Button is disabled by default (can be made relaunchable)
- Default text: "Error" or "Retry" if relaunchable

## Customization

### Custom Labels and Icons

<Canvas of={NetworkButtonStories.WithCustomLabels} />

Customize the appearance of each state:

```vue
<NetworkButton
  :query="saveQuery"
  :defaultButton="{
    text: 'Save Changes',
    icon: 'pi pi-save',
  }"
  :successButton="{
    text: 'Saved!',
    icon: 'pi pi-check-circle',
  }"
  :errorButton="{
    text: 'Save Failed',
    icon: 'pi pi-times-circle',
  }"
  :loadingButton="{
    text: 'Saving...',
  }"
/>
```

### Relaunchable Actions

#### Success State Relaunch

<Canvas of={NetworkButtonStories.RelaunchableOnSuccess} />

Allow users to trigger the action again after success:

```vue
<NetworkButton
  :query="refreshQuery"
  :relaunchableOnSuccess="true"
  :successButton="{
    text: 'Success - Click Again',
    icon: 'pi pi-refresh',
  }"
/>
```

#### Error State Retry

<Canvas of={NetworkButtonStories.RelaunchableOnError} />

Enable retry functionality when errors occur:

```vue
<NetworkButton :query="submitQuery" :relaunchableOnError="true" />
```

### Custom Styling

<Canvas of={NetworkButtonStories.WithCustomStyling} />

Apply custom CSS classes to any state:

```vue
<NetworkButton
  :query="styledQuery"
  :defaultButton="{
    text: 'Custom Button',
    class: 'p-button-lg p-button-rounded p-button-outlined',
  }"
  :successButton="{
    text: 'Custom Success',
    class: 'p-button-lg p-button-rounded',
  }"
/>
```

## Use Cases

### Form Submission

Perfect for form submission buttons that need to show progress and results:

```vue
<template>
  <form @submit.prevent="handleSubmit">
    <InputText v-model="formData.name" placeholder="Name" />
    <InputText v-model="formData.email" placeholder="Email" />

    <NetworkButton
      :query="submitFormQuery"
      :defaultButton="{ text: 'Submit Form', icon: 'pi pi-send' }"
      :successButton="{ text: 'Form Submitted!', icon: 'pi pi-check' }"
      :errorButton="{ text: 'Submission Failed', icon: 'pi pi-times' }"
      :relaunchableOnError="true"
    />
  </form>
</template>

<script setup>
import { reactive } from 'vue'
import { NetworkButton } from '@nside/wefa'
import { useApiClient } from '@/composables/api'

const formData = reactive({ name: '', email: '' })
const apiClient = useApiClient()

const submitFormQuery = apiClient.post('/api/forms', formData)

const handleSubmit = () => {
  submitFormQuery.action()
}
</script>
```

### Data Refresh

Ideal for refresh buttons that need to show loading state:

```vue
<template>
  <div class="data-panel">
    <div class="data-content">
      <!-- Your data display here -->
    </div>

    <NetworkButton
      :query="refreshDataQuery"
      :relaunchableOnSuccess="true"
      :defaultButton="{ text: 'Refresh Data', icon: 'pi pi-refresh' }"
      :loadingButton="{ text: 'Refreshing...', icon: 'pi pi-spin pi-spinner' }"
      :successButton="{ text: 'Data Updated', icon: 'pi pi-check' }"
    />
  </div>
</template>
```

### File Upload

Great for file upload scenarios with progress indication:

```vue
<template>
  <div class="upload-area">
    <input type="file" @change="handleFileSelect" />

    <NetworkButton
      :query="uploadFileQuery"
      :defaultButton="{ text: 'Upload File', icon: 'pi pi-upload' }"
      :loadingButton="{ text: 'Uploading...', icon: 'pi pi-spin pi-spinner' }"
      :successButton="{ text: 'Upload Complete', icon: 'pi pi-check-circle' }"
      :errorButton="{ text: 'Upload Failed', icon: 'pi pi-times-circle' }"
      :relaunchableOnError="true"
    />
  </div>
</template>
```

### Delete Confirmation

Useful for destructive actions that need clear feedback:

```vue
<template>
  <NetworkButton
    :query="deleteItemQuery"
    :defaultButton="{
      text: 'Delete Item',
      icon: 'pi pi-trash',
      class: 'p-button-danger p-button-outlined',
    }"
    :loadingButton="{ text: 'Deleting...' }"
    :successButton="{
      text: 'Deleted Successfully',
      icon: 'pi pi-check',
      class: 'p-button-success',
    }"
    :errorButton="{
      text: 'Delete Failed',
      icon: 'pi pi-exclamation-triangle',
      class: 'p-button-danger',
    }"
    :relaunchableOnError="true"
  />
</template>
```

## API Reference

### Props

<ArgTypes of={NetworkButtonStories} />

### ApiInterface

The `query` prop must implement the `ApiInterface` which provides:

```typescript
interface ApiInterface<T = unknown> {
  action: () => Promise<void> // Function to trigger the API call
  loading: Ref<boolean> // Reactive loading state
  result: Ref<T | undefined> // Reactive result data
  error: Ref<AxiosError | undefined> // Reactive error state
  called: Ref<boolean> // Whether the action has been called
  onSuccess: (fn: (result: T | undefined) => void) => void
  onError: (fn: (error: AxiosError) => void) => void
}
```

This interface is typically provided by the project's API client composables.

### SingleNetworkButtonProps

Configuration object for individual button states:

```typescript
interface SingleNetworkButtonProps {
  text?: string // Button label text
  class?: string // Additional CSS classes
  icon?: string // PrimeIcon class name (e.g., 'pi pi-check')
}
```

## Styling

The NetworkButton uses PrimeVue's Button component and supports all PrimeVue button styling:

- **Severities**: `primary`, `secondary`, `success`, `info`, `warning`, `danger`
- **Sizes**: Use classes like `p-button-sm`, `p-button-lg`
- **Variants**: `p-button-outlined`, `p-button-text`, `p-button-raised`
- **Shapes**: `p-button-rounded`, `p-button-icon`

### Tailwind CSS Integration

Since this is a PrimeVue-based component library, you can also use Tailwind classes for additional styling:

```vue
<NetworkButton
  :query="myQuery"
  :defaultButton="{
    text: 'Submit',
    class: 'shadow-lg hover:shadow-xl transition-shadow',
  }"
/>
```

## Accessibility

The NetworkButton inherits all accessibility features from PrimeVue Button:

- Proper ARIA attributes
- Keyboard navigation support
- Screen reader compatibility
- Focus management
- Disabled state handling

## Best Practices

1. **Always provide meaningful text**: Use descriptive labels that clearly indicate the action
2. **Use appropriate icons**: Choose PrimeIcons that match the action being performed
3. **Handle errors gracefully**: Enable `relaunchableOnError` for recoverable operations
4. **Provide feedback**: Customize success messages to confirm what was accomplished
5. **Consider loading states**: Use descriptive loading text for long-running operations
6. **Test thoroughly**: Ensure all states work correctly with your API integration

## Related Components

- **PrimeVue Button**: The underlying component that provides the base functionality
- **API Client**: The network layer that provides the `ApiInterface` implementation
- **Form Components**: Often used together with NetworkButton for form submissions
