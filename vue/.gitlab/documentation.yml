# Build the technical documentation from markdown files in the 'documentation' folder of the project
variables:
  BOB_TECH_DOC_VERSION: latest

BuildDocumentation:
  image: $NODE_IMAGE
  stage: documentation
  script:
    - mkdir -p target/tech_doc
    - cd vue
    - npm ci
    - npm run build
    - npm run build-storybook
    - mv storybook-static/* ../target/tech_doc
  artifacts:
    paths:
      - target/
    expire_in: 1 hour
  rules:
    - if: $CI_COMMIT_TAG
    - if: '$CI_COMMIT_BRANCH == "develop"'

PublishDocumentation:
  image: quay.io/n-side/bob-tech_doc:${BOB_TECH_DOC_VERSION}
  stage: documentation
  script:
    - python /bin/bob/tech_doc/build.py publish -p $CI_PROJECT_NAME -c $CI_COMMIT_SHA -u ${TECH_DOC_URL}/api
  variables:
    GIT_DEPTH: 0
  needs: ["BuildDocumentation"]
  rules:
    - if: $CI_COMMIT_TAG
    - if: '$CI_COMMIT_BRANCH == "develop"'